<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Teste do Módulo de Resultados</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; padding: 2rem; color: #333; }
        .test-case { border: 1px solid #ccc; border-radius: 8px; padding: 1rem 1.5rem; margin-bottom: 2rem; }
        h1, h2, h3 { color: #041A4A; }
        .state-container { display: flex; gap: 2rem; }
        .state { flex: 1; }
        pre { background-color: #f4f4f4; padding: 10px; border-radius: 5px; white-space: pre-wrap; word-wrap: break-word; font-size: 12px; }
        .success { color: green; font-weight: bold; }
        .fail { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Validação do Módulo de Resultados (`results.js`)</h1>
    <div id="test-results"></div>

    <script type="module">
        import { buildDoubleBracketStructure } from '../js/structures/double_bracket_structure.js';
        import { populateDoubleBracket } from '../js/logic/double_player_logic.js';
        import { resolveMatch, resolveInitialState } from '../js/results.js';
        import { parsePlayerInput } from '../js/parsing.js';

        const resultsContainer = document.getElementById('test-results');
        const playerList = `1. Ana\n2. Bia\n3. Carlos\n4. Davi\n5. Eva\n6. Fabio`;
        
        // --- GERAÇÃO DOS DADOS DE BASE ---
        let structure = buildDoubleBracketStructure(6);
        let tournamentData = { type: 'double', ...populateDoubleBracket(structure, playerList) };

        // --- TESTE 1: Resolução Automática do Estado Inicial (Byes) ---
        const initialState = JSON.parse(JSON.stringify(tournamentData));
        const stateAfterByes = resolveInitialState(initialState);
        
        let byeTestHtml = `<div class="test-case"><h2>Teste 1: Resolução Automática do Estado Inicial</h2>`;
        const anaInV2 = stateAfterByes.winnersBracket[1][0].p1.name === 'Ana';
        const biaInV2 = stateAfterByes.winnersBracket[1][1].p2.name === 'Bia';
        const bye1InP1 = stateAfterByes.losersBracket[0][0].p1.name === 'BYE_1';
        const bye2InP1 = stateAfterByes.losersBracket[0][1].p1.name === 'BYE_2';

        if (anaInV2 && biaInV2 && bye1InP1 && bye2InP1) {
            byeTestHtml += `<p class="success">✔️ SUCESSO: O estado inicial foi resolvido corretamente.</p>`;
        } else {
            byeTestHtml += `<p class="fail">❌ FALHA: A resolução do estado inicial falhou.</p>`;
        }
        byeTestHtml += `<div class="state-container"><div class="state"><h3>Estado Inicial (Pós-População)</h3><pre>${JSON.stringify(initialState, null, 2)}</pre></div>`;
        byeTestHtml += `<div class="state"><h3>Estado Final (Pós-Resolução de Byes)</h3><pre>${JSON.stringify(stateAfterByes, null, 2)}</pre></div></div></div>`;
        resultsContainer.innerHTML += byeTestHtml;

    </script>
</body>
</html>
