<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Teste do Módulo de Resultados</title>
</head>
<body>
    <h1>Abra a consola (F12) para ver os resultados dos testes.</h1>
    <script type="module">
        import { buildDoubleBracketStructure } from '../js/structures/double_bracket_structure.js';
        import { populateDoubleBracket } from '../js/logic/double_player_logic.js';
        import { resolveMatch, resolveInitialByes } from '../js/results.js';
        import { parsePlayerInput } from '../js/parsing.js';

        console.log("%c--- INICIANDO TESTES DE RESULTADOS ---", "font-size: 1.5em; font-weight: bold;");

        const playerList = `1. Ana\n2. Bia\n3. Carlos\n4. Davi\n5. Eva\n6. Fabio`; // 6 Jogadores (2 Byes)
        const { seededPlayers, unseededPlayers } = parsePlayerInput(playerList);
        const playerCount = seededPlayers.length + unseededPlayers.length;

        let structure = buildDoubleBracketStructure(playerCount);
        let tournamentData = { type: 'double', ...populateDoubleBracket(structure, playerList) };

        // --- TESTE 1: Resolução Automática dos Byes ---
        console.group("Teste 1: Resolução Automática dos Byes");
        const stateAfterByes = resolveInitialByes(tournamentData);
        
        const anaInV2 = stateAfterByes.winnersBracket[1][0].p1.name === 'Ana';
        const biaInV2 = stateAfterByes.winnersBracket[1][1].p2.name === 'Bia';
        const byeLoserInP1 = stateAfterByes.losersBracket[0].find(m => m.p1.isBye || m.p2.isBye);
        
        if (anaInV2 && biaInV2 && byeLoserInP1) {
            console.log("%c✔️ SUCESSO: Byes resolvidos e avançados corretamente.", "color: green");
        } else {
            console.error("❌ FALHA: A resolução de byes falhou.");
        }
        console.groupEnd();
        
        // --- TESTE 2: Resolução de Partida Manual ---
        console.group("Teste 2: Resolução de Partida Manual (Carlos vs Fabio)");
        const matchToUpdate = stateAfterByes.winnersBracket[0].find(m => m.p1?.name === 'Carlos');
        const matchIdToUpdate = matchToUpdate.id;
        const finalState = resolveMatch(stateAfterByes, matchIdToUpdate, { p1: '7', p2: '4' });

        const carlosInV2 = finalState.winnersBracket[1][1].p1.name === 'Carlos';
        const fabioInLosers = finalState.losersBracket[0].find(m => m.p1?.name === 'Fabio' || m.p2?.name === 'Fabio');
        
        if(carlosInV2 && fabioInLosers) {
             console.log("%c✔️ SUCESSO: Resolução de partida manual funcionou corretamente.", "color: green");
        } else {
            console.error("❌ FALHA: A resolução de partida manual falhou.");
        }
        console.groupEnd();

    </script>
</body>
</html>
