<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Teste do Módulo de Resultados</title>
    <style>
        /* ... (estilos do teste anterior) ... */
    </style>
</head>
<body>
    <h1>Validação do Módulo de Resultados (`results.js`)</h1>
    <div id="test-results"></div>

    <script type="module">
        import { buildDoubleBracketStructure } from '../js/structures/double_bracket_structure.js';
        import { populateDoubleBracket } from '../js/logic/double_player_logic.js';
        import { resolveMatch, resolveInitialByes } from '../js/results.js';
        import { parsePlayerInput } from '../js/parsing.js';
        import { getNextPowerOfTwo } from '../js/math.js';

        const resultsContainer = document.getElementById('test-results');
        const playerList = `1. Ana\n2. Bia\n3. Carlos\n4. Davi\n5. Eva\n6. Fabio`; // 6 Jogadores -> 2 Byes
        const { seededPlayers, unseededPlayers } = parsePlayerInput(playerList);
        const playerCount = seededPlayers.length + unseededPlayers.length;

        let structure = buildDoubleBracketStructure(playerCount);
        let tournamentData = { type: 'double', ...populateDoubleBracket(structure, playerList) };

        const initialState = JSON.parse(JSON.stringify(tournamentData));
        const finalStateObtained = resolveInitialByes(initialState);
        
        // **GABARITO: O ESTADO QUE ESPERAMOS OBTER**
        const expectedState = JSON.parse(JSON.stringify(initialState));
        expectedState.winnersBracket[1][0].p1 = { name: 'Ana', seed: 1, isBye: false };
        expectedState.winnersBracket[1][1].p2 = { name: 'Bia', seed: 2, isBye: false };
        const bye1 = initialState.winnersBracket[0].find(m => m.p1?.isBye || m.p2?.isBye).p2;
        const bye2 = initialState.winnersBracket[0].find(m => m.p1?.isBye || m.p2?.isBye, 1).p2;
        expectedState.losersBracket[0][0].p1 = bye1;
        expectedState.losersBracket[0][1].p1 = bye2;


        let html = `<div class="test-case"><h2>Teste de Resolução de Byes</h2>`;
        const success = JSON.stringify(finalStateObtained) === JSON.stringify(expectedState);
        html += success ? `<p class="success">✔️ SUCESSO</p>` : `<p class="fail">❌ FALHA</p>`;
        
        html += `<div class="state-container">`;
        html += `<div class="state"><h3>Estado Inicial</h3><pre>${JSON.stringify(initialState, null, 2)}</pre></div>`;
        html += `<div class="state"><h3>Estado Final (Esperado)</h3><pre>${JSON.stringify(expectedState, null, 2)}</pre></div>`;
        html += `<div class="state"><h3>Estado Final (Obtido)</h3><pre>${JSON.stringify(finalStateObtained, null, 2)}</pre></div>`;
        html += `</div></div>`;
        resultsContainer.innerHTML += html;

    </script>
</body>
</html>
