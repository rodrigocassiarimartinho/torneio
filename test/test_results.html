<!DOCTYPE html>
<html lang="pt-br">
<head>
    <title>Teste do Módulo de Resultados</title>
    <style>
        /* ... (estilos do teste anterior) ... */
    </style>
</head>
<body>
    <h1>Validação do Módulo de Resultados (`results.js`)</h1>
    <div id="test-results"></div>

    <script type="module">
        import { buildDoubleBracketStructure } from '../js/structures/double_bracket_structure.js';
        import { populateDoubleBracket } from '../js/logic/double_player_logic.js';
        import { resolveMatch, resolveInitialByes } from '../js/results.js';
        import { parsePlayerInput } from '../js/parsing.js';

        const resultsContainer = document.getElementById('test-results');
        const playerList = `1. Ana\n2. Bia\n3. Carlos\n4. Davi\n5. Eva\n6. Fabio\n7. Gabi\n8. Hugo`;
        
        // --- GERAÇÃO DOS DADOS DE BASE ---
        let structure = buildDoubleBracketStructure(8);
        let tournamentData = { type: 'double', ...populateDoubleBracket(structure, playerList) };

        // --- TESTE ---
        let initialState = JSON.parse(JSON.stringify(tournamentData));
        
        // Simula uma sequência de resultados
        let state1 = resolveMatch(initialState, 1, { p1: '7', p2: '5' }); // Ana vence Hugo
        let state2 = resolveMatch(state1, 2, { p1: '7', p2: '4' });     // Davi vence Eva
        let state3 = resolveMatch(state2, 3, { p1: '7', p2: '3' });     // Bia vence Gabi
        let state4 = resolveMatch(state3, 4, { p1: '7', p2: '1' });     // Carlos vence Fabio
        
        let state5 = resolveMatch(state4, 8, { p1: '7', p2: '6' });      // Hugo vence Eva na P1
        let state6 = resolveMatch(state5, 9, { p1: '7', p2: '2' });      // Gabi vence Fabio na P1
        
        let state7 = resolveMatch(state6, 5, { p1: '7', p2: '0' });      // Ana vence Davi na V2
        
        const finalState = state7; // O estado final após a sequência

        let html = `<div class="test-case"><h2>Teste de Sequência de Resultados</h2>`;
        
        // Validações
        const winnerOfM5 = finalState.winnersBracket[2][0].p1.name;
        const loserOfM5 = finalState.losersBracket[1].find(m => m.p2?.name === 'Davi');
        const winnerOfP1 = finalState.losersBracket[1][0].p1.name;

        if (winnerOfM5 === 'Ana' && loserOfM5 && winnerOfP1 === 'Hugo') {
            html += `<p class="success">✔️ SUCESSO: A sequência de resultados foi processada corretamente.</p>`;
        } else {
            html += `<p class="fail">❌ FALHA: A sequência de resultados falhou.</p>`;
        }
        
        html += `<div class="state-container"><div class="state"><h3>Estado Inicial</h3><pre>${JSON.stringify(initialState, null, 2)}</pre></div>`;
        html += `<div class="state"><h3>Estado Final</h3><pre>${JSON.stringify(finalState, null, 2)}</pre></div></div></div>`;
        resultsContainer.innerHTML += html;

    </script>
</body>
</html>
