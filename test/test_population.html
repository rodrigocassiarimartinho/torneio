<!DOCTYPE html>
<html lang="en">
<head>
    <title>Teste dos Módulos de População</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; padding: 2rem; color: #333; }
        .test-case { border: 1px solid #ccc; border-radius: 8px; padding: 1rem 1.5rem; margin-bottom: 2rem; background-color: #fff; }
        h1, h2, h3 { color: #041A4A; }
        table { border-collapse: collapse; width: 100%; margin-top: 1rem; font-size: 0.9em; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        td.round-title { font-weight: bold; }
        td.match-id { font-weight: bold; color: #8899a6; width: 1%;}
    </style>
</head>
<body>
    <h1>Validação dos Módulos de População da Chave</h1>
    <div id="test-results"></div>

    <script type="module">
        import { buildSingleBracketStructure } from './js/structures/single_bracket_structure.js';
        import { buildDoubleBracketStructure } from './js/structures/double_bracket_structure.js';
        import { populateSingleBracket } from './js/logic/single_player_logic.js';
        import { populateDoubleBracket } from './js/logic/double_player_logic.js';

        const resultsContainer = document.getElementById('test-results');

        function renderStructureToPage(description, structure) {
            let html = `<div class="test-case">`;
            html += `<h2>${description}</h2>`;

            const renderTable = (title, bracket) => {
                if (!bracket || bracket.length === 0) return;
                html += `<h3>${title}</h3><table><thead><tr><th>Partida</th><th>Jogador 1 (Slot)</th><th>Jogador 2 (Slot)</th></tr></thead><tbody>`;
                (bracket || []).forEach((round, i) => {
                    html += `<tr><td colspan="3" class="round-title">Rodada ${i+1}</td></tr>`;
                    (round || []).forEach(match => {
                        const p1_text = match.p1?.name || '(Apontador)';
                        const p2_text = match.p2?.name || '(Apontador)';
                        html += `<tr><td class="match-id">M${match.id}</td><td>${p1_text}</td><td>${p2_text}</td></tr>`;
                    });
                });
                html += `</tbody></table>`;
            };
            
            if (structure.rounds) {
                 renderTable('Chave de Eliminação Simples', structure.rounds);
            } else {
                renderTable('Chave dos Vencedores', structure.winnersBracket);
                renderTable('Chave dos Perdedores', structure.losersBracket);
                renderTable('Grande Final', structure.grandFinal);
            }

            html += `</div>`;
            resultsContainer.innerHTML += html;
        }
        
        const playerList = Array.from({length: 8}, (_, i) => `${i+1}. S${i+1}`).join('\n') + '\n' + Array.from({length: 12}, (_, i) => `P${i+9}`).join('\n');
        const playerCount = 20;

        // Teste da Eliminação Simples
        const emptySingleStructure = buildSingleBracketStructure(playerCount);
        const populatedSingleStructure = populateSingleBracket(emptySingleStructure, playerList);
        renderStructureToPage(`Teste de População (Simples) com ${playerCount} Jogadores`, populatedSingleStructure);

        // Teste da Dupla Eliminação
        const emptyDoubleStructure = buildDoubleBracketStructure(playerCount);
        const populatedDoubleStructure = populateDoubleBracket(emptyDoubleStructure, playerList);
        renderStructureToPage(`Teste de População (Dupla) com ${playerCount} Jogadores`, populatedDoubleStructure);

    </script>
</body>
</html>
